import{d as st,e as ht,t as p,c as ot,a as v,b as yt}from"./BI9x2Sv-.js";import{k as xt,h as Re,A as rt,l as kt,v as lt,W as wt,aC as Ct,aB as Dt,D as It,X as Pt,q as Ut,p as Ye,w as We,g as e,u as he,f as ze,r as a,a as Xe,c as s,s as r,t as L,a8 as it,b as ie,d as C,n as Fe}from"./C7yO5yPs.js";import{d as Ze,s as W,e as Mt}from"./C2vv__MR.js";import{i as x}from"./BGOvWai6.js";import{e as Ue,i as Me}from"./CSQrPbMc.js";import{r as z,s as Te}from"./DIyWOdGJ.js";import{a as Rt}from"./CExfrwZq.js";import{r as At}from"./jPbBvQ6a.js";import{b as X,a as qt}from"./ZONVNPKG.js";import{b as St}from"./DfDD2GHB.js";import{p as se}from"./0fouXmC9.js";import{o as Vt}from"./BREDD7G0.js";import{s as Nt}from"./nC63Ge9I.js";import{P as nt,l as Le}from"./C2QKWiPL.js";import{o as Ot}from"./BBhubecf.js";function He(g,o,b,q,j){var U=g,u="",D;xt(()=>{if(u===(u=o()??"")){Re&&rt();return}D!==void 0&&(Ut(D),D=void 0),u!==""&&(D=kt(()=>{if(Re){lt.data;for(var f=rt(),t=f;f!==null&&(f.nodeType!==8||f.data!=="");)t=f,f=wt(f);if(f===null)throw Ct(),Dt;st(lt,t),U=It(f);return}var k=u+"",M=ht(k);st(Pt(M),M.lastChild),U.before(M)}))})}function Ge(g,o,b,q,j,U){var u=g.__className;if(Re||u!==b||u===void 0){var D=Rt(b,q);(!Re||D!==g.getAttribute("class"))&&(D==null?g.removeAttribute("class"):g.className=D),g.__className=b}return U}var Bt=p("<span><!></span>"),Et=(g,o,b)=>o(e(b).id),jt=p('<div class="if-content svelte-reeaka"><!></div>'),Ft=p('<div class="else-header"><span class="else-tag svelte-reeaka">&#123;&#123;:else&#125;&#125;</span></div>'),Tt=p('<div class="else-content svelte-reeaka"><!></div>'),Lt=p('<div class="if-block svelte-reeaka"><div class="if-header svelte-reeaka"><button class="toggle-arrow svelte-reeaka"> </button><span> </span></div><!><!><!><div class="if-footer"><span>&#123;&#123;/if&#125;&#125;</span></div></div>'),Ht=p('<div class="prompt-formatter svelte-reeaka"></div>');function Wt(g,o){Ye(o,!0);let b=se(o,"goal",3,null);const q=/\{\{(?!#if|\/if|:else)([^{}]+)\}\}/g,j=/\{\{#if\s+([^{}]+)\}\}(.*?)(?:\{\{:else\}\}(.*?))?\{\{\/if\}\}/gs,U=We({});function u(m){return m?m.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"):""}function D(m){var n;return!b()||!((n=b().inputOutput)!=null&&n.inputExample)?!1:m in b().inputOutput.inputExample}function f(){if(!o.message)return[];const m=[];let n=0,w,I=0;for(j.lastIndex=0;(w=j.exec(o.message))!==null;){if(w.index>n){const B=o.message.substring(n,w.index);m.push({type:"text",content:t(B)})}const[R,P,S,O]=w,J=D(P)?"valid-condition":"invalid-condition",l=I++,_={type:"ifBlock",id:l,condition:P,ifContent:t(S),colorClass:J,collapsed:U[l]||!1};O!==void 0&&(_.elseContent=t(O)),m.push(_),n=w.index+R.length}if(n<o.message.length){const R=o.message.substring(n);m.push({type:"text",content:t(R)})}return m}function t(m){let n="",w=0;q.lastIndex=0;let I;for(;(I=q.exec(m))!==null;){n+=u(m.substring(w,I.index));const R=I[1],P=I[0];let S="neutral-var";b()&&(S=D(R)?"valid-var":"invalid-var");const O=u(R),Z=u(P);n+=`<span class="${S}" title="${O}">${Z}</span>`,w=I.index+P.length}return n+=u(m.substring(w)),n}function k(m){U[m]=!U[m]}let M=he(f);var H=Ht();Ue(H,21,()=>e(M),Me,(m,n)=>{var w=ot(),I=ze(w);{var R=S=>{var O=Bt(),Z=s(O);He(Z,()=>e(n).content),a(O),v(S,O)},P=(S,O)=>{{var Z=J=>{var l=Lt(),_=s(l),B=s(_);B.__click=[Et,k,n];var ye=s(B,!0);a(B);var ve=r(B),de=s(ve);a(ve),a(_);var re=r(_);{var xe=A=>{var F=jt(),ee=s(F);He(ee,()=>e(n).ifContent),a(F),v(A,F)};x(re,A=>{e(n).collapsed||A(xe)})}var le=r(re);{var ce=A=>{var F=Ft();v(A,F)};x(le,A=>{e(n).elseContent!==void 0&&A(ce)})}var ue=r(le);{var ke=A=>{var F=Tt(),ee=s(F);He(ee,()=>e(n).elseContent),a(F),v(A,F)};x(ue,A=>{!e(n).collapsed&&e(n).elseContent!==void 0&&A(ke)})}var we=r(ue),Ae=s(we);a(we),a(l),L(()=>{W(ye,e(n).collapsed?"▶":"▼"),Ge(ve,1,`if-tag ${e(n).colorClass??""}`,"svelte-reeaka"),W(de,`{{#if ${e(n).condition??""}}}`),Ge(Ae,1,`if-end-tag ${e(n).colorClass??""}`,"svelte-reeaka")}),v(J,l)};x(S,J=>{e(n).type==="ifBlock"&&J(Z)},O)}};x(I,S=>{e(n).type==="text"?S(R):S(P,!1)})}v(m,w)}),a(H),v(g,H),Xe()}Ze(["click"]);var Gt=g=>g.stopPropagation(),Yt=p('<div class="modal-backdrop svelte-1mjb7sl"><div class="modal-content svelte-1mjb7sl"><div class="modal-header svelte-1mjb7sl"><h3 class="svelte-1mjb7sl"> </h3> <button class="close-button svelte-1mjb7sl">&times;</button></div> <div class="modal-body svelte-1mjb7sl"><!></div></div></div>');function zt(g,o){Ye(o,!0);let b=se(o,"isOpen",7),q=se(o,"onClose",3,null);const j=()=>{b(!1)};it(()=>(b()?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>document.body.style.overflow="unset"));var U=ot(),u=ze(U);{var D=f=>{var t=Yt();t.__click=function(...R){var P;(P=q()||j)==null||P.apply(this,R)};var k=s(t);k.__click=[Gt];var M=s(k),H=s(M),m=s(H,!0);a(H);var n=r(H,2);n.__click=function(...R){var P;(P=q()||j)==null||P.apply(this,R)},a(M);var w=r(M,2),I=s(w);Nt(I,()=>o.children),a(w),a(k),a(t),L(()=>W(m,o.title)),v(f,t)};x(u,f=>{b()&&f(D)})}v(g,U),Xe()}Ze(["click"]);var Xt=p('<div class="error-message svelte-138vltr"> </div>'),Zt=p('<div class="form-group svelte-138vltr"><label for="maxRuns">Max Runs</label> <input type="number" id="maxRuns" min="0" class="form-control svelte-138vltr"></div>'),Jt=p('<small class="error-text svelte-138vltr"> </small>'),Kt=p('<small class="svelte-138vltr">Unique identifier (URL-safe characters only)<!></small>'),Qt=p('<div class="form-control loading-placeholder svelte-138vltr">Loading models...</div>'),$t=p("<option> </option>"),ea=p('<select id="model" class="form-control svelte-138vltr" required><option>Select a model</option><!></select>'),ta=p('<code class="variable-key svelte-138vltr"> </code>'),aa=p('<div class="goal-variables svelte-138vltr"><h4 class="svelte-138vltr"> </h4> <div class="example-input svelte-138vltr"></div> <p class="variables-help svelte-138vltr">You can use these variables in your messages with the syntax <code></code></p></div>'),sa=p('<div class="loading-placeholder svelte-138vltr">No example input available for this goal</div>'),ra=p('<div class="form-group svelte-138vltr"><label>Goal Variables</label> <!></div>'),la=p('<div class="form-group svelte-138vltr"><label for="uid">UID</label> <input type="text" id="uid" class="form-control svelte-138vltr" required> <!></div> <div class="form-group svelte-138vltr"><label for="model">Default Model</label> <!></div> <div class="form-group parameters-section svelte-138vltr"><h3 class="svelte-138vltr">Parameters</h3> <details class="advanced-params svelte-138vltr"><summary class="svelte-138vltr">Show parameters</summary> <div class="parameter-grid svelte-138vltr"><div class="parameter-item"><label for="temperature">Temperature</label> <input type="number" id="temperature" min="0" max="2" step="0.1" class="form-control svelte-138vltr"></div> <div class="parameter-item"><label for="max_tokens">Max Tokens</label> <input type="number" id="max_tokens" min="1" class="form-control svelte-138vltr"></div> <div class="parameter-item"><label for="top_p">Top P</label> <input type="number" id="top_p" min="0" max="1" step="0.01" class="form-control svelte-138vltr"></div> <div class="parameter-item"><label for="frequency_penalty">Frequency Penalty</label> <input type="number" id="frequency_penalty" min="-2" max="2" step="0.1" class="form-control svelte-138vltr"></div> <div class="parameter-item"><label for="presence_penalty">Presence Penalty</label> <input type="number" id="presence_penalty" min="-2" max="2" step="0.1" class="form-control svelte-138vltr"></div></div></details></div> <!>',1),na=(g,o)=>o("system"),oa=(g,o)=>o("user"),ia=(g,o)=>o("assistant"),va=p('<div class="message-controls svelte-138vltr"><button type="button" class="btn btn-sm svelte-138vltr">Add System</button> <button type="button" class="btn btn-sm svelte-138vltr">Add User</button> <button type="button" class="btn btn-sm svelte-138vltr">Add Assistant</button></div>'),da=p('<textarea class="message-textarea svelte-138vltr" rows="4" required></textarea>'),ca=p('<div class="message-controls-bar svelte-138vltr"><button type="button" class="btn-icon svelte-138vltr" title="Move up">↑</button> <button type="button" class="btn-icon svelte-138vltr" title="Move down">↓</button> <button type="button" class="btn-icon btn-danger svelte-138vltr" title="Remove">×</button></div>'),ua=p('<label class="message-card svelte-138vltr"><div class="message-type-header svelte-138vltr"><span> </span></div> <!> <div class="preview svelte-138vltr"><span class="preview-label svelte-138vltr">Preview</span> <div class="preview-content svelte-138vltr"><!></div></div> <!></label>'),ma=p('<div class="prompt-modal svelte-138vltr"><!> <form><div class="form-group svelte-138vltr"><label for="weight">Weight</label> <input type="number" id="weight" min="0" step="0.1" class="form-control svelte-138vltr"> <small class="svelte-138vltr">Higher weight means this prompt will be used more often</small></div> <div class="canary-section svelte-138vltr"><h3 class="svelte-138vltr">Canary Testing</h3> <div class="form-group svelte-138vltr"><label class="checkbox-label svelte-138vltr"><input type="checkbox"> Use as canary test</label> <small class="svelte-138vltr">Canary prompts are used for testing and monitoring</small></div> <!></div> <!> <div class="form-group messages-section svelte-138vltr"><div class="messages-header svelte-138vltr"><h3 class="svelte-138vltr">Messages</h3> <!></div> <div class="messages-list svelte-138vltr"></div></div> <div class="form-actions svelte-138vltr"><button type="button" class="btn btn-secondary svelte-138vltr">Cancel</button> <button type="submit" class="btn btn-primary svelte-138vltr"> </button></div></form></div>');function Ma(g,o){Ye(o,!0);let b=se(o,"prompt",3,null),q=se(o,"prefillData",3,null),j=se(o,"onClose",3,()=>{}),U=se(o,"onSave",3,null);const u=he(()=>!b()||!!q()),D=he(()=>b()||q());let f=he(()=>{var l;return Le.goals[((l=b())==null?void 0:l.goalUID)||o.goalUID]||null}),t=ie(We({UID:"",goalUID:o.goalUID||"",model:"",parameters:new nt,messages:[{role:"user",content:""}],weight:1,isCanary:!1,maxRuns:0,totalRuns:0})),k=ie(null),M=ie(!1),H=ie(We([])),m=ie(!0),n=ie(null);it(()=>{e(D)?(C(t,{...e(D)},!0),q()&&(e(t).UID="",e(t).totalRuns=0),(!e(t).messages||e(t).messages.length===0)&&(e(t).messages=[{role:"user",content:""}])):(e(t).goalUID=e(f).UID,e(t).UID="",e(t).model="",e(t).parameters=new nt,e(t).messages=[{role:"user",content:""}],e(t).weight=1,e(t).isCanary=!1,e(t).maxRuns=0,e(t).totalRuns=0)}),Vt(async()=>{try{C(m,!0),C(H,await Ot.load(),!0)}catch(l){console.error("Failed to fetch models:",l)}finally{C(m,!1)}});function w(l){return/^[a-zA-Z0-9-_]+$/.test(l)?(C(n,null),!0):(C(n,"UID can only contain letters, numbers, dashes, and underscores (no spaces)"),!1)}function I(l){e(t).messages=[...e(t).messages,{role:l,content:""}]}function R(l){if(e(t).messages.length<=1){C(k,"At least one message is required");return}e(t).messages=e(t).messages.filter((_,B)=>B!==l)}function P(l){if(l<=0)return;const _=[...e(t).messages];[_[l-1],_[l]]=[_[l],_[l-1]],e(t).messages=_}function S(l){if(l>=e(t).messages.length-1)return;const _=[...e(t).messages];[_[l],_[l+1]]=[_[l+1],_[l]],e(t).messages=_}function O(){if(C(k,null),C(n,null),e(u)&&!e(t).UID.trim())return C(n,"UID is required"),!1;if(e(u)&&!w(e(t).UID))return!1;if(!e(t).model)return C(k,"Please select a default model"),!1;if(!e(t).messages||e(t).messages.length===0)return C(k,"At least one message is required"),!1;for(const l of e(t).messages)if(!l.content.trim())return C(k,`${l.role} message cannot be empty`),!1;return!0}async function Z(){if(O()){C(M,!0),C(k,null);try{e(u)?await Le.createPrompt(e(t)):await Le.updatePrompt(e(t).UID,e(t)),U()&&U()(e(t)),j()()}catch(l){C(k,l instanceof Error?l.message:"An error occurred",!0),console.error("Form submission error:",l)}finally{C(M,!1)}}}const J=he(()=>e(u)?"Create Prompt":"Edit Prompt");zt(g,{get isOpen(){return o.isOpen},get title(){return e(J)},get onClose(){return j()},children:(l,_)=>{var B=ma(),ye=s(B);{var ve=d=>{var c=Xt(),h=s(c,!0);a(c),L(()=>W(h,e(k))),v(d,c)};x(ye,d=>{e(k)&&d(ve)})}var de=r(ye,2),re=s(de),xe=r(s(re),2);z(xe),Fe(2),a(re);var le=r(re,2),ce=r(s(le),2),ue=s(ce),ke=s(ue);z(ke),Fe(),a(ue),Fe(2),a(ce);var we=r(ce,2);{var Ae=d=>{var c=Zt(),h=r(s(c),2);z(h),a(c),X(h,()=>e(t).maxRuns,V=>e(t).maxRuns=V),v(d,c)};x(we,d=>{e(t).isCanary&&d(Ae)})}a(le);var A=r(le,2);{var F=d=>{var c=la(),h=ze(c),V=r(s(h),2);z(V);var te=r(V,2);{var me=i=>{var y=Jt(),Y=s(y,!0);a(y),L(()=>W(Y,e(n))),v(i,y)},Ve=i=>{var y=Kt(),Y=r(s(y));{var ge=T=>{var Q=yt("- must be different from original");v(T,Q)};x(Y,T=>{q()&&T(ge)})}a(y),v(i,y)};x(te,i=>{e(n)?i(me):i(Ve,!1)})}a(h);var ne=r(h,2),Ne=r(s(ne),2);{var pe=i=>{var y=Qt();v(i,y)},Ce=i=>{var y=ea(),Y=s(y);Y.value=((Y.__value="")==null,"");var ge=r(Y);Ue(ge,17,()=>e(H),Me,(T,Q)=>{var ae=$t(),Pe={},$=s(ae,!0);a(ae),L(()=>{Pe!==(Pe=e(Q).id)&&(ae.value=(ae.__value=e(Q).id)==null?"":e(Q).id),W($,e(Q).name)}),v(T,ae)}),a(y),St(y,()=>e(t).model,T=>e(t).model=T),v(i,y)};x(Ne,i=>{e(m)?i(pe):i(Ce,!1)})}a(ne);var fe=r(ne,2),De=r(s(fe),2),Ie=r(s(De),2),N=s(Ie),E=r(s(N),2);z(E),a(N);var G=r(N,2),oe=r(s(G),2);z(oe),a(G);var _e=r(G,2),K=r(s(_e),2);z(K),a(_e);var Oe=r(_e,2),$e=r(s(Oe),2);z($e),a(Oe);var et=r(Oe,2),tt=r(s(et),2);z(tt),a(et),a(Ie),a(De),a(fe);var ut=r(fe,2);{var mt=i=>{var y=ra(),Y=r(s(y),2);{var ge=(T,Q)=>{{var ae=$=>{var be=aa(),Be=s(be),pt=s(Be);a(Be);var Ee=r(Be,2);Ue(Ee,21,()=>Object.keys(e(f).exampleInput),Me,(_t,gt)=>{var je=ta(),bt=s(je,!0);a(je),L(()=>W(bt,`{{${e(gt)}}}`)),v(_t,je)}),a(Ee);var at=r(Ee,2),ft=r(s(at));ft.textContent="{{variableName}}",a(at),a(be),L(()=>W(pt,`Example Input for ${e(f).title||"Goal"}`)),v($,be)},Pe=$=>{var be=sa();v($,be)};x(T,$=>{e(f)&&e(f).exampleInput?$(ae):$(Pe,!1)},Q)}};x(Y,T=>{T(ge,!1)})}a(y),v(i,y)};x(ut,i=>{e(f)&&i(mt)})}X(V,()=>e(t).UID,i=>e(t).UID=i),X(E,()=>e(t).parameters.temperature,i=>e(t).parameters.temperature=i),X(oe,()=>e(t).parameters.max_tokens,i=>e(t).parameters.max_tokens=i),X(K,()=>e(t).parameters.top_p,i=>e(t).parameters.top_p=i),X($e,()=>e(t).parameters.frequency_penalty,i=>e(t).parameters.frequency_penalty=i),X(tt,()=>e(t).parameters.presence_penalty,i=>e(t).parameters.presence_penalty=i),v(d,c)};x(A,d=>{e(u)&&d(F)})}var ee=r(A,2),qe=s(ee),vt=r(s(qe),2);{var dt=d=>{var c=va(),h=s(c);h.__click=[na,I];var V=r(h,2);V.__click=[oa,I];var te=r(V,2);te.__click=[ia,I],a(c),v(d,c)};x(vt,d=>{e(u)&&d(dt)})}a(qe);var Je=r(qe,2);Ue(Je,21,()=>e(t).messages,Me,(d,c,h)=>{var V=ua();Te(V,"for",`message-textarea-${h}`);var te=s(V),me=s(te),Ve=s(me,!0);a(me),a(te);var ne=r(te,2);{var Ne=N=>{var E=da();At(E),Te(E,"id",`message-textarea-${h}`),L(()=>Te(E,"placeholder",`Enter ${e(c).role} message...`)),X(E,()=>e(c).content,G=>e(c).content=G),v(N,E)};x(ne,N=>{e(u)&&N(Ne)})}var pe=r(ne,2),Ce=r(s(pe),2),fe=s(Ce);Wt(fe,{get message(){return e(c).content},get goal(){return e(f)}}),a(Ce),a(pe);var De=r(pe,2);{var Ie=N=>{var E=ca(),G=s(E);G.__click=K=>{K.preventDefault(),P(h)},G.disabled=h===0;var oe=r(G,2);oe.__click=K=>{K.preventDefault(),S(h)};var _e=r(oe,2);_e.__click=K=>{K.preventDefault(),R(h)},a(E),L(()=>oe.disabled=h===e(t).messages.length-1),v(N,E)};x(De,N=>{e(u)&&N(Ie)})}a(V),L(N=>{Ge(me,1,`message-type ${e(c).role??""}`,"svelte-138vltr"),W(Ve,N)},[()=>e(c).role.charAt(0).toUpperCase()+e(c).role.slice(1)]),v(d,V)}),a(Je),a(ee);var Ke=r(ee,2),Qe=s(Ke);Qe.__click=function(...d){var c;(c=j())==null||c.apply(this,d)};var Se=r(Qe,2),ct=s(Se,!0);a(Se),a(Ke),a(de),a(B),L(()=>{Se.disabled=e(M),W(ct,e(M)?"Saving...":e(u)?"Create":"Update")}),Mt("submit",de,d=>{d.preventDefault(),Z()}),X(xe,()=>e(t).weight,d=>e(t).weight=d),qt(ke,()=>e(t).isCanary,d=>e(t).isCanary=d),v(l,B)},$$slots:{default:!0}}),Xe()}Ze(["click"]);export{zt as M,Ma as P,Wt as a,He as h,Ge as s};
